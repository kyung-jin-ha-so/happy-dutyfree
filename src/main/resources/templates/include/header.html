<th:block th:fragment="header">
    <!--    최근검색어 클릭시 안보이게 하기 위함-->
    <header>
        <div id="wrap">
            <!-- header -->
            <div id="haeder">
                <div class="gnb">
                    <ul>
                        <li><a href="javascript:;">로그인</a></li>
                        <li><a href="javascript:;">회원가입</a></li>
                        <li><a href="javascript:;">MY행복</a></li>
                        <li><a href="javascript:;">장바구니</a></li>
                        <li><a href="javascript:;">오늘의 환율 1$ = <b id="rate" th:text="${session.exchangeRate}"></b>원</a>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- header// -->

            <div class="content">
                <!-- header 아래 검색창 -->
                <div class="search">
                    <div class="left_box">
                        <!-- logo img_size 133 * 57 -->
                        <div class="logo">
                            <a href="/">
                                <img src="/img/logo.jpg" alt="">
                            </a>
                        </div>

                        <div class="category">
                            <a href="javascript:;">카테고리</a>
                            <ul class="depth02">
                                <li><a href="/product/1/">스킨케어</a></li>
                                <li><a href="/product/2/">메이크업</a></li>
                                <li><a href="/product/3/">향수/바디/헤어</a></li>
                                <li><a href="/product/4/">가방/신발/잡화</a></li>
                                <li><a href="/product/5/">시계/쥬얼리</a></li>
                                <li><a href="/product/6/">의류/아이웨어</a></li>
                                <li><a href="/product/7/">스포츠/레저</a></li>
                                <li><a href="/product/8/">디지털/리빙</a></li>
                                <li><a href="/product/9/">식품</a></li>
                                <li><a href="/product/10/">유아동</a></li>
                                <li><a href="/product/11/">남성관</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="center_box">
                        <form action="/product/search/" method="get" name="searchForm" id="searchForm">
                            <div th:if="${session.loginId}">
                                <div class="input_box">
                                    <input type="text" name="q" id="q" placeholder="상품명 검색">
                                    <div id="recommend">
                                        <div id="recent_search"></div>
                                    </div>
                                    <a href="#"><img src="/img/input_click.png" id="search" alt=""></a>
                                </div>
                            </div>
                            <div th:unless="${session.loginId}">
                                <div class="input_box">
                                    <input type="text" name="q" placeholder="상품명 검색">
                                    <a href="#"><img src="/img/input_click.png" alt=""></a>
                                </div>
                            </div>
                        </form>
                    </div>
                    <!-- img_size 225 * 80 -->
                    <div class="right_box">
                        <a href="javascript:;">
                            <!-- <img src="" alt=""> -->
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <script !src="">

        $("#search").click(function () {
            $("#searchForm").submit();
        });

        $(document).ready(function () {

            const exchangeRate = document.getElementById("rate");
            let exchange = "";

            var myHeaders = new Headers();
            myHeaders.append("apikey", "");

            var requestOptions = {
                method: 'GET',
                redirect: 'follow',
                headers: myHeaders
            };

            fetch("https://api.apilayer.com/exchangerates_data/convert?to=KRW&from=USD&amount=1", requestOptions)
                .then(response => {
                    return response.json();
                })
                .then(json => {
                    exchangeRate.innerHTML = json["result"].toFixed(2);
                    exchange = json["result"];
                })
                .catch(error => console.log('error', error));
        });

        //최근 검색어 창 띄우는 함수
        $("#q").mousedown(function () {
            const recommendBox = document.querySelector("#recommend");
            const loginId = [[${session.loginId}]];
            const recentSearch = document.getElementById("recent_search");
            recommendBox.classList.remove('invisible');

            $.ajax({
                method: 'post',
                url: '/search/find',
                data: {
                    'loginId': loginId,
                },
                dataType: 'json',
                success: function (res) {

                    let output = "<div>최근 검색어</div>\n";

                    for (let i = 0; i < res.length; i++) {
                        output += "<div id=\"recommend_item\" class=\"item\">\n";
                        output += "<span class=\"text\" onclick=\'putSearch(" + '"' + res[i].searchName + '"' + ")\'>" + res[i].searchName + "</span>\n";
                        output += "<div class=\"right\">\n"
                        output += "<span class=\"small align-self-end\">" + res[i].searchCreatedTime + "</span>\n";
                        output += "<span class=\"small align-self-end btn\" onclick=\'searchDelete(" + res[i].searchId + ")\'>X</span>\n";
                        output += "</div>";
                        output += "</div>";

                    }
                    recentSearch.innerHTML = output;

                }, error: function () {
                    alert("에러입니다.");
                }
            })
        });

        //최근 검색어 삭제하는 함수
        const searchDelete = (searchId) => {
            $.ajax({
                method: "post",
                url: "/search/delete",
                data: {"searchId": searchId},
                dataType: "text",
                success: function (res) {
                    console.log(res);
                    location.reload();
                }, error: function () {
                    alert("ajax 오류")
                }
            });
        };

        //최근 검색어 클릭시 검색창에 넣어지는 함수
        const putSearch = (searchName) => {
            const recommendBox = document.querySelector("#recommend");
            const inputBox = document.querySelector("input");

            inputBox.value = searchName;
            recommendBox.classList.add('invisible');
        }

        //검색창에 글씨 쓰면 최근 검색어 사라짐
        const inputBox = document.querySelector("input");
        const recommendBox = document.querySelector("#recommend");

        inputBox.addEventListener("keyup", (e) => {
            if (e.target.value.length > 0) {
                recommendBox.classList.add('invisible');
            } else {
                recommendBox.classList.remove('invisible');
            }
        })

    </script>
</th:block>
