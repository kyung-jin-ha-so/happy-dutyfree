<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h2>장바구니</h2>
<table>
    <tr>
        <th>선택</th>
        <th>상품</th>
        <th>원가</th>
        <th>할인율</th>
        <th>인터넷할인가</th>
        <th>수량</th>
        <th>썸네일</th>
        <th>상품별 총 금액</th>
    </tr>
    <tr th:each="cart : ${cartList}">
        <td><select name="" id=""></select></td>
        <td><a th:href="@{|/product/detail/${cart.productId}|}" th:text="${cart.productName}"></a></td>
        <td><STRIKE th:text="${cart.productOriginalPrice}"></STRIKE></td>
        <td th:text="${cart.productDiscount}"></td>
        <td th:text="${cart.productPrice}" id="productPrice" th:value="${cart.productPrice}"></td>
        <td>
            <button th:onclick="'minusBtn(' + ${cart.cartId} + ')'" class="minus_btn"> -</button>
        <input type="text" class="quantity_input" th:id="${cart.cartId}" th:value="${cart.cartQty}">
            <button th:onclick="'plusBtn(' + ${cart.cartId} + ')'" class="plus_btn"> +</button>
        </td>

        <td><img th:src="@{|/upload/${cart.productThumbnail}|}" width="100" height="100" alt=""></td>
        <td th:text="${cart.cartQty*cart.productPrice}"></td>
    </tr>
</table>
</body>
<script th:inline="javascript" th:each="cart: ${cartList}">
    function plusBtn(cartId) {
        let quantity = document.getElementById(cartId).value;
        quantity = ++quantity;
        document.getElementById(cartId).value = quantity;
        const id = [[${cart.cartId}]];
        const updateData = JSON.stringify({ //stringify = josn으로 변환해주는 역할
            cartId: cartId,
            cartQty: quantity
        });
        $.ajax({
            type:"post",
            data: updateData,
            url: "/cart/update/",
            contentType: "application/json",
            success: function () {
                alert("수정을 성공")
                location.reload();
            },
            error: function () {
                alert("ajax 실패");
            }
        });
    }
    function minusBtn(cartId) {
        let quantity = document.getElementById(cartId).value;
        quantity = --quantity;
        document.getElementById(cartId).value = quantity;
        const id = [[${cart.cartId}]];
        const updateData = JSON.stringify({ //stringify = josn으로 변환해주는 역할
            cartId: cartId,
            cartQty: quantity
        });
        $.ajax({
            type:"post",
            data: updateData,
            url: "/cart/update/",
            contentType: "application/json",
            success: function () {
                alert("수정을 성공")
                location.reload();
            },
            error: function () {
                alert("ajax 실패");
            }
        });
    }
</script>
</html>