<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <script th:src="@{/js/bootstrap.bundle.min.js}"></script>
</head>
<body>
상품 상세 정보

<div class="container">
    <table class="table">
        <tr>
            <th>상품번호</th>
            <th>이름</th>
            <th>상세설명</th>
            <th>원가</th>
            <th>할인율</th>
            <th>인터넷할인가</th>
            <th>썸네일</th>
            <th>찜하기</th>
        </tr>
        <tr>
            <td th:text="${product.productId}"></td>
            <td th:text="${product.productName}"></td>
            <td th:text="${product.productDesc}"></td>
            <td th:text="${product.productOriginalPrice}"></td>
            <td th:text="${product.productDiscount}"></td>
            <td th:text="${product.productPrice}"></td>
            <td><img th:src="@{|/upload/${product.productThumbnail}|}" width="100" height="100" alt=""></td>

            <td th:each="like: ${likeList}" th:if="${like.likeId} == null"><i class="bi bi-heart" onclick="saveWish()"></i></td>
            <td th:each="like: ${likeList}" th:if="${like.likeId}!= null"><i class="bi bi-heart-fill" onclick="deleteWish()"></i></td>
        </tr>
    </table>

<!--    <div th:each="${session.loginEmail == 'admin'}">-->
        <a th:href="@{|/product/update/${product.productId}|}">수정</a>
<!--    </div>-->

    상세 설명이미지
    <div th:each="productFile: ${product.productFilesEntityList}" >
        <img th:src="@{|/upload/${productFile.productFileName}|}" alt="">
    </div>

    <p2>소희 찜 확인용 test</p2>
    <div th:each="like: ${likeList}">
        <div th:text="${like.likeId}"></div>
        <div th:text="${like.memberEntity.memberId}"></div>
        <div th:text="${like.productEntity.productId}"></div>
    </div>
</div>

<div>
    상품 후기
    <table class="table">
        <tr>
            <th>상품후기 번호</th>
            <th>상품후기 작성자</th>
            <th>상품후기 작성내용</th>
            <th>상품후기 별점</th>
            <th>상품후기 작성시간</th>
        </tr>
        <tr th:each="productReview: ${product.reviewEntityList}">
            <td th:text="${productReview.reviewId}"></td>
            <td th:text="${productReview.memberEntity.memberId}"></td>
            <td th:text="${productReview.reviewContents}"></td>
            <td th:text="${productReview.reviewStar}"></td>
            <td th:text="${productReview.getCreatedTime()}"></td>
        </tr>
    </table>

</div>
</body>
<script th:inline="javascript">
    function saveWish() {
        if ([[${session.loginEmail}]] == null) {
            alert("로그인 후 찜하실 수 있습니다");
            location.href = "/member/login";
        } else {
            let memberId = [[${session.loginId}]];
            let productId = [[${product.productId}]];
            $.ajax({
                type: "post",
                url: "/product/like",
                data: {
                    "memberId": memberId,
                    "productId": productId
                },
                dataType: "text",
                success: function (result) {
                    alert("찜하기 성공")
                }, error: function () {
                    alert("찜하기 실패")
                }
            })
        }
    }

    function deleteWish() {
        if ([[${session.loginEmail}]] == null) {
            alert("로그인 후 찜하실 수 있습니다");
            location.href = "/member/login";
        } else {
            let memberId = [[${session.loginId}]];
            let productId = [[${product.productId}]];
            $.ajax({
                type: "post",
                url: "/product/like",
                data: {
                    "memberId": memberId,
                    "productId": productId
                },
                dataType: "text",
                success: function (result) {
                    alert("찜취소 성공")
                }, error: function () {
                    alert("찜 취소 실패");
                }
            })
        }
    }
</script>
</html>